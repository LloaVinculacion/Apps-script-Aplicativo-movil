{"files":[{"id":"551c1dc4-2209-42d9-ac1d-9e91929c6c0b","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"America/Guayaquil\",\n  \"dependencies\": {\n    \"libraries\": [\n      {\n        \"userSymbol\": \"FirebaseApp\",\n        \"version\": \"30\",\n        \"libraryId\": \"1hguuh4Zx72XVC1Zldm_vTtcUUKUA6iBUOoGnJUWLfqDWx5WlOJHqYkrt\"\n      }\n    ],\n    \"enabledAdvancedServices\": [\n      {\n        \"userSymbol\": \"Sheets\",\n        \"version\": \"v4\",\n        \"serviceId\": \"sheets\"\n      }\n    ]\n  },\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"webapp\": {\n    \"executeAs\": \"USER_DEPLOYING\",\n    \"access\": \"ANYONE_ANONYMOUS\"\n  }\n}"},{"id":"069a9752-bacf-4512-9749-6f65c71c9843","name":"Code","type":"server_js","source":"//Firebase ID Library 1hguuh4Zx72XVC1Zldm_vTtcUUKUA6iBUOoGnJUWLfqDWx5WlOJHqYkrt\n\n// Define las variables globales\nvar FirebaseUrl \u003d \"https://vacunas-33400-default-rtdb.firebaseio.com/\";\nvar SheetId \u003d \"1jANyD0255nc4Mrj1KzXb39pXqZjEtS5GNVtUk-NlEoI\";\n\nfunction doGet() {\n  // Conectar a Firebase\n  var baseDatos \u003d FirebaseApp.getDatabaseByUrl(FirebaseUrl);\n  \n  // Obtener una referencia a la hoja de Google Sheets\n  var sheetName \u003d \"Vacunas\"; // Nombre de la hoja donde deseas exportar los datos\n  var spreadsheet \u003d SpreadsheetApp.openById(SheetId);\n  var sheet \u003d spreadsheet.getSheetByName(sheetName);\n  \n  // Crear la hoja si no existe\n  if (sheet \u003d\u003d\u003d null) {\n    sheet \u003d spreadsheet.insertSheet(sheetName);\n  } else {\n    // Limpiar la hoja de cálculo si existe\n    sheet.clearContents();\n  }\n  \n  // Obtener los datos de Firebase\n  var data \u003d baseDatos.getData();\n  Logger.log(JSON.stringify(data, null, 2));\n  // Escribir los datos en la hoja de cálculo en el orden especificado\n  var headerRow \u003d [\"IdAnimal\", \"Vacuna\", \"Tipo\", \"Aplicacion\", \"Fecha\", \"IdVet\", \"NameVet\", \"Observaciones\"];\n  sheet.appendRow(headerRow);\n  \n  for (var animal in data) {\n    for (var vacuna in data[animal]) {\n      var rowData \u003d [\n        animal,\n        vacuna,\n        data[animal][vacuna].Tipo.replace(/\"/g, \u0027\u0027), // Eliminar comillas dobles\n        data[animal][vacuna].Aplicacion.replace(/\"/g, \u0027\u0027), // Eliminar comillas dobles\n        data[animal][vacuna].Fecha.replace(/\"/g, \u0027\u0027), // Eliminar comillas dobles\n        data[animal][vacuna].IdVet.replace(/\"/g, \u0027\u0027), // Eliminar comillas dobles\n        data[animal][vacuna].NameVet.replace(/\"/g, \u0027\u0027), // Eliminar comillas dobles\n        data[animal][vacuna].Observaciones.replace(/\"/g, \u0027\u0027) // Eliminar comillas dobles\n      ];\n      \n      // Reemplazar celdas vacías con \"N/A\"\n      for (var i \u003d 0; i \u003c rowData.length; i++) {\n        if (rowData[i] \u003d\u003d\u003d \"\") {\n          rowData[i] \u003d \"N/A\";\n        }\n      }\n      \n      sheet.appendRow(rowData);\n    }\n  }\n  \n  // Alinear celdas a la izquierda\n  var numRows \u003d sheet.getLastRow();\n  var numCols \u003d sheet.getLastColumn();\n  if (numRows \u003e\u003d 2) {\n    var range \u003d sheet.getRange(2, 1, numRows - 1, numCols); // Excluir la fila de encabezado\n    range.setHorizontalAlignment(\"left\");\n  } else {\n    Logger.log(\"No existen datos en la base de datos.\");\n  }\n\n  // Cambiar la primera fila por las cabeceras deseadas\n  var headerRowValues \u003d [\"ID ANIMAL\", \"VACUNA\", \"TIPO\", \"APLICACION\", \"FECHA\", \"ID VET\", \"NOMBRE VET\", \"OBSERVACIONES\"];\n  sheet.getRange(1, 1, 1, headerRowValues.length).setValues([headerRowValues]);\n\n  // Notificar que la exportación se ha completado\n  Logger.log(\"Exportación de datos completada.\");\n}"}]}